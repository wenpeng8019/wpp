<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQTP Callback Style - ä¼ ç»Ÿå›è°ƒæ–¹å¼ç¤ºä¾‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 10px;
    }
    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .code-block {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .code-block h3 {
      margin-top: 0;
      color: #007bff;
    }
    pre {
      background: #282c34;
      color: #abb2bf;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .keyword { color: #c678dd; }
    .function { color: #61afef; }
    .string { color: #98c379; }
    .comment { color: #5c6370; font-style: italic; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
    #output {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      min-height: 100px;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #17a2b8; }
  </style>
</head>
<body>
  <h1>ğŸ”„ SQTP ä¼ ç»Ÿå›è°ƒæ–¹å¼ vs Promise/Async-Await</h1>
  
  <p>
    <strong>ä¼ ç»Ÿå›è°ƒæ–¹å¼</strong>ä½¿ç”¨ error-first callback æ¨¡å¼ï¼Œè¿™æ˜¯ Node.js å’Œæ—©æœŸ JavaScript çš„æ ‡å‡†åšæ³•ã€‚
    é€‚åˆä¸æ”¯æŒ Promise çš„æ—§ç¯å¢ƒï¼Œæˆ–è€…æ‚¨æ›´ä¹ æƒ¯å›è°ƒé£æ ¼ã€‚
  </p>

  <div class="comparison">
    <div class="code-block">
      <h3>âŒ Promise/Async-Await (ç°ä»£æ–¹å¼)</h3>
      <pre><code><span class="comment">// åˆå§‹åŒ–</span>
<span class="keyword">const</span> db = <span class="keyword">new</span> <span class="function">SQTP</span>(<span class="string">'http://localhost:8080/db/test'</span>);

<span class="comment">// ä½¿ç”¨ async/await</span>
<span class="keyword">async function</span> <span class="function">queryUsers</span>() {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> result = <span class="keyword">await</span> db.<span class="function">select</span>(<span class="string">'users'</span>)
      .<span class="function">where</span>(<span class="string">"age >= 18"</span>)
      .<span class="function">execute</span>();
    
    <span class="function">console.log</span>(result.data);
  } <span class="keyword">catch</span> (err) {
    <span class="function">console.error</span>(err);
  }
}</code></pre>
    </div>

    <div class="code-block">
      <h3>âœ… Callback (ä¼ ç»Ÿæ–¹å¼)</h3>
      <pre><code><span class="comment">// åˆå§‹åŒ–</span>
<span class="keyword">const</span> db = <span class="keyword">new</span> <span class="function">SQTPCallback</span>(<span class="string">'http://localhost:8080/db/test'</span>);

<span class="comment">// ä½¿ç”¨ä¼ ç»Ÿå›è°ƒ</span>
<span class="keyword">function</span> <span class="function">queryUsers</span>() {
  db.<span class="function">select</span>(<span class="string">'users'</span>)
    .<span class="function">where</span>(<span class="string">"age >= 18"</span>)
    .<span class="function">execute</span>(<span class="keyword">function</span>(err, result) {
      <span class="keyword">if</span> (err) {
        <span class="function">console.error</span>(err);
        <span class="keyword">return</span>;
      }
      <span class="function">console.log</span>(result.data);
    });
}</code></pre>
    </div>
  </div>

  <h2>å®Œæ•´ç¤ºä¾‹å¯¹æ¯”</h2>

  <div class="comparison">
    <div class="code-block">
      <h3>Promise é“¾å¼è°ƒç”¨</h3>
      <pre><code><span class="comment">// é¡ºåºæ‰§è¡Œå¤šä¸ªæ“ä½œ</span>
db.<span class="function">insert</span>(<span class="string">'users'</span>)
  .<span class="function">values</span>({ name: <span class="string">'Alice'</span>, age: 25 })
  .<span class="function">execute</span>()
  .<span class="function">then</span>(<span class="keyword">function</span>(result) {
    <span class="keyword">return</span> db.<span class="function">select</span>(<span class="string">'users'</span>).<span class="function">execute</span>();
  })
  .<span class="function">then</span>(<span class="keyword">function</span>(result) {
    <span class="function">console.log</span>(result.data);
  })
  .<span class="function">catch</span>(<span class="keyword">function</span>(err) {
    <span class="function">console.error</span>(err);
  });</code></pre>
    </div>

    <div class="code-block">
      <h3>åµŒå¥—å›è°ƒ (Callback Hell)</h3>
      <pre><code><span class="comment">// é¡ºåºæ‰§è¡Œå¤šä¸ªæ“ä½œ</span>
db.<span class="function">insert</span>(<span class="string">'users'</span>)
  .<span class="function">values</span>({ name: <span class="string">'Alice'</span>, age: 25 })
  .<span class="function">execute</span>(<span class="keyword">function</span>(err, result) {
    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="function">console.error</span>(err);
    
    db.<span class="function">select</span>(<span class="string">'users'</span>).<span class="function">execute</span>(<span class="keyword">function</span>(err, result) {
      <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="function">console.error</span>(err);
      
      <span class="function">console.log</span>(result.data);
    });
  });</code></pre>
    </div>
  </div>

  <h2>å®é™…è¿è¡Œç¤ºä¾‹</h2>
  <div>
    <button onclick="testCallback()">è¿è¡Œä¼ ç»Ÿå›è°ƒç¤ºä¾‹</button>
    <button onclick="testPromise()">è¿è¡Œ Promise ç¤ºä¾‹</button>
    <button onclick="clearOutput()">æ¸…é™¤è¾“å‡º</button>
  </div>
  
  <div id="output"></div>

  <!-- åŠ è½½ä¸¤ä¸ªç‰ˆæœ¬çš„åº“ -->
  <script src="sqtp.xhr.callback.js"></script>
  <script src="sqtp.xhr.promise.js"></script>
  
  <script>
    const output = document.getElementById('output');
    
    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = typeof message === 'object' ? JSON.stringify(message, null, 2) : message;
      output.appendChild(div);
    }
    
    function clearOutput() {
      output.innerHTML = '';
    }
    
    // ä¼ ç»Ÿå›è°ƒæ–¹å¼ç¤ºä¾‹
    function testCallback() {
      clearOutput();
      log('=== ä¼ ç»Ÿå›è°ƒæ–¹å¼ç¤ºä¾‹ ===', 'info');
      
      // ä½¿ç”¨å›è°ƒç‰ˆæœ¬ï¼ˆè¿æ¥åˆ°æ¨¡æ‹ŸæœåŠ¡å™¨ï¼‰
      const db = new SQTPCallback('http://localhost:8080/db/test', { debug: true });
      
      // ç¤ºä¾‹ 1: ç®€å•æŸ¥è¯¢
      log('1. æ‰§è¡ŒæŸ¥è¯¢...', 'info');
      db.select('users')
        .where("age >= 18")
        .limit(5)
        .execute(function(err, result) {
          if (err) {
            log('âŒ é”™è¯¯: ' + err.message, 'error');
            return;
          }
          log('âœ… æŸ¥è¯¢æˆåŠŸ', 'success');
          log('è¿”å›æ•°æ®: ' + JSON.stringify(result, null, 2), 'info');
        });
      
      // ç¤ºä¾‹ 2: æ’å…¥æ•°æ®ï¼ˆåµŒå¥—å›è°ƒï¼‰
      setTimeout(function() {
        log('\n2. æ’å…¥æ•°æ®ï¼ˆåµŒå¥—å›è°ƒï¼‰...', 'info');
        db.insert('users')
          .values({ name: 'Bob', age: 30, email: 'bob@test.com' })
          .execute(function(err, result) {
            if (err) {
              log('âŒ æ’å…¥å¤±è´¥: ' + err.message, 'error');
              return;
            }
            log('âœ… æ’å…¥æˆåŠŸ, ID: ' + result.headers['X-SQTP-Last-Insert-Id'], 'success');
            
            // åµŒå¥—ï¼šæ’å…¥åç«‹å³æŸ¥è¯¢
            db.select('users')
              .where("name = 'Bob'")
              .execute(function(err, result) {
                if (err) {
                  log('âŒ æŸ¥è¯¢å¤±è´¥: ' + err.message, 'error');
                  return;
                }
                log('âœ… æŸ¥è¯¢åˆ°æ–°æ’å…¥çš„æ•°æ®:', 'success');
                log(JSON.stringify(result.data, null, 2), 'info');
              });
          });
      }, 1000);
    }
    
    // Promise/Async-Await æ–¹å¼ç¤ºä¾‹
    async function testPromise() {
      clearOutput();
      log('=== Promise/Async-Await æ–¹å¼ç¤ºä¾‹ ===', 'info');
      
      // ä½¿ç”¨ Promise ç‰ˆæœ¬
      const db = new SQTP('http://localhost:8080/db/test', { debug: true });
      
      try {
        // ç¤ºä¾‹ 1: ç®€å•æŸ¥è¯¢
        log('1. æ‰§è¡ŒæŸ¥è¯¢...', 'info');
        const result1 = await db.select('users')
          .where("age >= 18")
          .limit(5)
          .execute();
        log('âœ… æŸ¥è¯¢æˆåŠŸ', 'success');
        log('è¿”å›æ•°æ®: ' + JSON.stringify(result1, null, 2), 'info');
        
        // ç¤ºä¾‹ 2: æ’å…¥æ•°æ®ï¼ˆæ— éœ€åµŒå¥—ï¼‰
        log('\n2. æ’å…¥æ•°æ®...', 'info');
        const result2 = await db.insert('users')
          .values({ name: 'Charlie', age: 35, email: 'charlie@test.com' })
          .execute();
        log('âœ… æ’å…¥æˆåŠŸ, ID: ' + result2.headers['X-SQTP-Last-Insert-Id'], 'success');
        
        // æ’å…¥åç«‹å³æŸ¥è¯¢ï¼ˆä»£ç æ›´æ¸…æ™°ï¼‰
        const result3 = await db.select('users')
          .where("name = 'Charlie'")
          .execute();
        log('âœ… æŸ¥è¯¢åˆ°æ–°æ’å…¥çš„æ•°æ®:', 'success');
        log(JSON.stringify(result3.data, null, 2), 'info');
        
      } catch (err) {
        log('âŒ é”™è¯¯: ' + err.message, 'error');
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
    log('ğŸ‘† ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŸ¥çœ‹ä¸¤ç§æ–¹å¼çš„è¿è¡Œæ•ˆæœ', 'info');
    log('', 'info');
    log('ğŸ’¡ æ³¨æ„ï¼šä¸¤ç§æ–¹å¼åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œåªæ˜¯ä»£ç é£æ ¼ä¸åŒ', 'info');
    log('â€¢ å›è°ƒæ–¹å¼ï¼šé€‚åˆæ—§é¡¹ç›®ã€ä¸æ”¯æŒ Promise çš„ç¯å¢ƒ', 'info');
    log('â€¢ Promise æ–¹å¼ï¼šç°ä»£æ¨èï¼Œä»£ç æ›´æ¸…æ™°ï¼Œé”™è¯¯å¤„ç†æ›´ç»Ÿä¸€', 'info');
  </script>
</body>
</html>
